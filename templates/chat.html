{% extends 'base.html' %}
{% load static %}

{% block title %}Chat Interface{% endblock %}

{% block content %}
<!-- Adjusted container to account for navbar height, e.g., navbar is 16rem (64px) -->
<div class="flex flex-col md:flex-row h-[calc(100vh-4rem)] bg-[#171717] text-white overflow-hidden">
    <!-- Chat History Sidebar -->
    <aside class="w-full md:w-64 lg:w-1/5 xl:w-1/6 overflow-y-auto bg-[#2c2c2c] p-4">
        <ul>
            <!-- Dynamically populate chat history here -->
            <li class="py-2 border-b border-gray-700 cursor-pointer">Chat 1</li>
            <li class="py-2 border-b border-gray-700 cursor-pointer">Chat 2</li>
        </ul>
    </aside>
    
    <!-- Chat Main Area -->
    <main class="flex-1 flex flex-col">
        <!-- Chat Container -->
        <div class="flex-1 flex flex-col p-6 overflow-hidden">
            <!-- Chat Messages -->
            <div id="chat" class="flex-1 mb-4 p-4 bg-[#202020] overflow-y-auto rounded-lg">
                <!-- Chat messages will go here -->
            </div>
            
            <!-- Message Input -->
            <div class="flex">
                <input type="text" id="messageInput" class="flex-1 p-2 border-gray-300 rounded-l-lg focus:outline-none focus:ring bg-[#292929] text-white" placeholder="Type your message...">
                <button id="sendMessage" class="bg-blue-500 hover:bg-blue-600 text-white px-4 rounded-r-lg">Send</button>
            </div>
        </div>
    </main>
</div>

<script>
    document.getElementById('sendMessage').addEventListener('click', function() {
        var messageInput = document.getElementById('messageInput');
        var message = messageInput.value;
        console.log(message); // For debugging
        fetch("{% url 'chat_view' %}", {
            method: "POST",
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({
                'message': message,
                'model_name': 'gpt-3.5-turbo' // or dynamically set based on user selection
            })
        })
        .then(response => response.json())
        .then(data => {
            console.log(data); // For debugging
            // Display the response in the chat window
            var chatWindow = document.getElementById('chat');
            var responseElement = document.createElement('div');
            responseElement.textContent = data.response;
            chatWindow.appendChild(responseElement);
            // Clear the input after sending
            messageInput.value = '';
        })
        .catch(error => console.error('Error:', error));
    });
    </script>
    
{% endblock %}
